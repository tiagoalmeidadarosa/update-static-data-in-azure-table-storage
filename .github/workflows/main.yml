name: Upload Data To Azure Table Storage
on:
  push:
    branches:
      - main
    paths:
      - '**.csv'

env:
  WORKING_DIR: ./UpdateStaticDataInAzureTableStorage
  
jobs:
  upload:
    runs-on: ubuntu-latest
    name: Test changed-files
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # OR "2" -> To retrieve the preceding commit.

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v14.6
        with:
          files: |
            *.csv

      - name: List all changed files
        run: |
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            - uses: bhowell2/github-substring-action
              id: substring-action
              with:
                value: file
                length_from_end: 4
            - uses: tiagoalmeidadarosa/update-static-data-in-azure-table-storage@v1.0.5
              with:
                table_name: ${{ steps.substring-action.outputs.substring }}
                connection_string: ${{ secrets.AzureStorageConnectionString }}
                csv_file_path: ${{ env.WORKING_DIR }}/${{ steps.substring-action.outputs.substring }}.csv
          done
